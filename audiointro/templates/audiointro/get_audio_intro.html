<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form with Textboxes and Audio Control</title>
</head>
<body>
    <h2>Query</h2>
    <form>
        <textarea type="text" id="query" name="query" style="width:400px;height:100px;resize:none;"></textarea><br>
        <button style="width:400px;" type="button" onclick="sendPostRequest()">Go</button><br><br>
    </form>

    <h2>Result</h2>
    <audio controls>
        <source src="" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio><br>
    <textarea id="result" name="result" style="width:400px;height:500px;resize:none;" readonly></textarea><br><br>
</body>

<script>
    function sendPostRequest() {
        const queryValue = document.getElementById('query').value;
        if (!queryValue) {
            return; // Do nothing if queryValue is empty
        }
        
        fetch('/audiointro/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ query: queryValue })
        })
        .then(response => response.json())
        .then(data => {
            // document.getElementById('result').value = JSON.stringify(data, null, 2);
            document.getElementById('result').value = data.result_text;
            // Process audio binary, and initialize it on audio control
            const audioElement = document.querySelector('audio');
            const audioSource = audioElement.querySelector('source');
            const blob = new Blob([new Uint8Array(atob(data.result_audio).split('').map(char => char.charCodeAt(0)))], { type: 'audio/mpeg' });
            const audioURL = URL.createObjectURL(blob);
            audioSource.src = audioURL;
            audioElement.load();
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
</script>
</html>

